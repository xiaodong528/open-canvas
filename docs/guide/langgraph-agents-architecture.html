<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Open Canvas LangGraph æ™ºèƒ½ä½“æ¶æ„</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
  <style>
    :root {
      --bg-primary: #0d1117;
      --bg-secondary: #161b22;
      --bg-tertiary: #21262d;
      --text-primary: #e6edf3;
      --text-secondary: #8b949e;
      --text-muted: #6e7681;
      --border-color: #30363d;
      --accent-color: #58a6ff;
      --accent-hover: #79c0ff;
      --code-bg: #161b22;
      --success-color: #3fb950;
      --warning-color: #d29922;
      --error-color: #f85149;
      --sidebar-width: 280px;
    }

    [data-theme="light"] {
      --bg-primary: #ffffff;
      --bg-secondary: #f6f8fa;
      --bg-tertiary: #eaeef2;
      --text-primary: #1f2328;
      --text-secondary: #656d76;
      --text-muted: #8c959f;
      --border-color: #d0d7de;
      --accent-color: #0969da;
      --accent-hover: #0550ae;
      --code-bg: #f6f8fa;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif;
      background-color: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      font-size: 16px;
    }

    /* Header */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 60px;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 24px;
      z-index: 100;
    }

    .header-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .header-title svg {
      width: 28px;
      height: 28px;
      fill: var(--accent-color);
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .theme-toggle {
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      padding: 8px 12px;
      cursor: pointer;
      color: var(--text-primary);
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s;
    }

    .theme-toggle:hover {
      background: var(--border-color);
    }

    /* Sidebar */
    .sidebar {
      position: fixed;
      top: 60px;
      left: 0;
      width: var(--sidebar-width);
      height: calc(100vh - 60px);
      background: var(--bg-secondary);
      border-right: 1px solid var(--border-color);
      overflow-y: auto;
      padding: 20px 0;
      z-index: 50;
      transition: transform 0.3s;
    }

    .sidebar-toggle {
      display: none;
      position: fixed;
      bottom: 20px;
      left: 20px;
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: var(--accent-color);
      color: white;
      border: none;
      cursor: pointer;
      z-index: 200;
      font-size: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }

    .toc-title {
      padding: 0 20px 12px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      color: var(--text-muted);
      letter-spacing: 0.5px;
    }

    .toc-list {
      list-style: none;
    }

    .toc-item {
      margin: 0;
    }

    .toc-link {
      display: block;
      padding: 8px 20px;
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 14px;
      border-left: 2px solid transparent;
      transition: all 0.2s;
    }

    .toc-link:hover {
      color: var(--text-primary);
      background: var(--bg-tertiary);
    }

    .toc-link.active {
      color: var(--accent-color);
      border-left-color: var(--accent-color);
      background: var(--bg-tertiary);
    }

    .toc-link.level-3 {
      padding-left: 36px;
      font-size: 13px;
    }

    .toc-link.level-4 {
      padding-left: 52px;
      font-size: 12px;
    }

    /* Main Content */
    .main {
      margin-left: var(--sidebar-width);
      margin-top: 60px;
      min-height: calc(100vh - 60px);
    }

    .content {
      max-width: 900px;
      margin: 0 auto;
      padding: 40px 32px;
    }

    /* Typography */
    .content h1 {
      font-size: 32px;
      font-weight: 600;
      margin-bottom: 16px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border-color);
    }

    .content h2 {
      font-size: 24px;
      font-weight: 600;
      margin-top: 48px;
      margin-bottom: 16px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--border-color);
    }

    .content h3 {
      font-size: 20px;
      font-weight: 600;
      margin-top: 32px;
      margin-bottom: 12px;
    }

    .content h4 {
      font-size: 16px;
      font-weight: 600;
      margin-top: 24px;
      margin-bottom: 8px;
    }

    .content p {
      margin-bottom: 16px;
      color: var(--text-primary);
    }

    .content a {
      color: var(--accent-color);
      text-decoration: none;
    }

    .content a:hover {
      text-decoration: underline;
    }

    .content ul, .content ol {
      margin-bottom: 16px;
      padding-left: 24px;
    }

    .content li {
      margin-bottom: 8px;
    }

    .content strong {
      font-weight: 600;
    }

    .content hr {
      border: none;
      border-top: 1px solid var(--border-color);
      margin: 32px 0;
    }

    /* Code Blocks */
    .content pre {
      background: var(--code-bg);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 16px;
      overflow-x: auto;
      margin-bottom: 16px;
      font-family: 'SF Mono', 'Fira Code', 'Monaco', 'Menlo', monospace;
      font-size: 14px;
      line-height: 1.5;
    }

    .content pre code {
      background: none;
      padding: 0;
      border-radius: 0;
      font-size: inherit;
    }

    .content code {
      background: var(--bg-tertiary);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'SF Mono', 'Fira Code', 'Monaco', 'Menlo', monospace;
      font-size: 0.9em;
    }

    /* Tables */
    .content table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 16px;
      font-size: 14px;
    }

    .content th, .content td {
      padding: 12px 16px;
      text-align: left;
      border: 1px solid var(--border-color);
    }

    .content th {
      background: var(--bg-secondary);
      font-weight: 600;
    }

    .content tr:nth-child(even) {
      background: var(--bg-secondary);
    }

    /* Blockquotes */
    .content blockquote {
      border-left: 4px solid var(--accent-color);
      padding-left: 16px;
      margin: 16px 0;
      color: var(--text-secondary);
    }

    /* ASCII Art - preserve formatting */
    .content pre code:not([class*="language-"]) {
      white-space: pre;
      font-family: 'SF Mono', 'Fira Code', 'Monaco', 'Menlo', monospace;
    }

    /* Anchor links */
    .content h2[id], .content h3[id], .content h4[id] {
      position: relative;
    }

    .content h2[id]:hover .anchor-link,
    .content h3[id]:hover .anchor-link,
    .content h4[id]:hover .anchor-link {
      opacity: 1;
    }

    .anchor-link {
      position: absolute;
      left: -24px;
      color: var(--text-muted);
      opacity: 0;
      transition: opacity 0.2s;
      text-decoration: none;
    }

    /* Back to top */
    .back-to-top {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 44px;
      height: 44px;
      border-radius: 8px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      color: var(--text-primary);
      cursor: pointer;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }

    .back-to-top.visible {
      opacity: 1;
      visibility: visible;
    }

    .back-to-top:hover {
      background: var(--accent-color);
      color: white;
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .sidebar {
        transform: translateX(-100%);
      }

      .sidebar.open {
        transform: translateX(0);
      }

      .sidebar-toggle {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .main {
        margin-left: 0;
      }

      .content {
        padding: 24px 16px;
      }
    }

    @media (max-width: 768px) {
      .header-title span {
        display: none;
      }

      .content h1 {
        font-size: 24px;
      }

      .content h2 {
        font-size: 20px;
      }

      .content pre {
        font-size: 12px;
        padding: 12px;
      }

      .content table {
        font-size: 12px;
      }

      .content th, .content td {
        padding: 8px;
      }
    }

    /* Print styles */
    @media print {
      .header, .sidebar, .back-to-top, .sidebar-toggle {
        display: none !important;
      }

      .main {
        margin-left: 0 !important;
        margin-top: 0 !important;
      }

      .content {
        max-width: none;
        padding: 0;
      }
    }

    /* Highlight.js overrides */
    .hljs {
      background: transparent !important;
    }

    /* Loading state */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 200px;
      color: var(--text-muted);
    }

    /* Badge styles for feature highlights */
    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }

    .badge-primary {
      background: var(--accent-color);
      color: white;
    }

    .badge-success {
      background: var(--success-color);
      color: white;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-title">
      <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
      </svg>
      <span>Open Canvas LangGraph æ™ºèƒ½ä½“æ¶æ„</span>
    </div>
    <div class="header-actions">
      <button class="theme-toggle" onclick="toggleTheme()">
        <span id="theme-icon">ğŸŒ™</span>
        <span id="theme-text">æ·±è‰²</span>
      </button>
    </div>
  </header>

  <!-- Sidebar -->
  <nav class="sidebar" id="sidebar">
    <div class="toc-title">ç›®å½•å¯¼èˆª</div>
    <ul class="toc-list" id="toc"></ul>
  </nav>

  <!-- Sidebar Toggle (Mobile) -->
  <button class="sidebar-toggle" id="sidebar-toggle" onclick="toggleSidebar()">â˜°</button>

  <!-- Main Content -->
  <main class="main">
    <article class="content" id="content">
      <div class="loading">åŠ è½½ä¸­...</div>
    </article>
  </main>

  <!-- Back to Top -->
  <button class="back-to-top" id="back-to-top" onclick="scrollToTop()">â†‘</button>

  <!-- Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/12.0.0/marked.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/typescript.min.js"></script>

  <script>
    // Markdown content
    const markdownContent = `# Open Canvas LangGraph æ™ºèƒ½ä½“æ¶æ„

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç» Open Canvas åç«¯çš„ LangGraph æ™ºèƒ½ä½“ç³»ç»Ÿæ¶æ„ï¼ŒåŒ…æ‹¬å„å›¾çš„åŠŸèƒ½ã€èŠ‚ç‚¹è®¾è®¡ã€çŠ¶æ€ç®¡ç†å’Œåä½œæœºåˆ¶ã€‚

## ç›®å½•

- [ç³»ç»Ÿæ¦‚è§ˆ](#ç³»ç»Ÿæ¦‚è§ˆ)
- [æ¶æ„å›¾](#æ¶æ„å›¾)
- [ä¸»æ™ºèƒ½ä½“å›¾ (Open Canvas)](#ä¸»æ™ºèƒ½ä½“å›¾-open-canvas)
- [åæ€å›¾ (Reflection)](#åæ€å›¾-reflection)
- [ç½‘ç»œæœç´¢å›¾ (Web Search)](#ç½‘ç»œæœç´¢å›¾-web-search)
- [æ ‡é¢˜ç”Ÿæˆå›¾ (Thread Title)](#æ ‡é¢˜ç”Ÿæˆå›¾-thread-title)
- [æ‘˜è¦å›¾ (Summarizer)](#æ‘˜è¦å›¾-summarizer)
- [å·¥å…·å‡½æ•°åº“](#å·¥å…·å‡½æ•°åº“)
- [æç¤ºè¯ç­–ç•¥](#æç¤ºè¯ç­–ç•¥)
- [å¤šæ¨¡å‹æ”¯æŒ](#å¤šæ¨¡å‹æ”¯æŒ)

---

## ç³»ç»Ÿæ¦‚è§ˆ

Open Canvas é‡‡ç”¨ **å¤šå›¾åä½œæ¶æ„**ï¼Œé€šè¿‡ LangGraph ç¼–æ’ 5 ä¸ªä¸“é—¨çš„å›¾æ¥å¤„ç†ä¸åŒçš„å·¥ä½œæµï¼š

\`\`\`
langgraph.json é…ç½®çš„ 5 ä¸ªå›¾ï¼š
â”œâ”€â”€ agent (open-canvas)     â†’ ä¸»å›¾ï¼šè·¯ç”±ã€å·¥ä»¶ç”Ÿæˆä¸ç¼–è¾‘
â”œâ”€â”€ reflection              â†’ è®°å¿†åæ€ï¼šç”¨æˆ·é£æ ¼å­¦ä¹ 
â”œâ”€â”€ thread_title            â†’ æ ‡é¢˜ç”Ÿæˆï¼šå¯¹è¯å‘½å
â”œâ”€â”€ summarizer              â†’ å¯¹è¯æ‘˜è¦ï¼šé•¿å¯¹è¯å‹ç¼©
â””â”€â”€ web_search              â†’ ç½‘ç»œæœç´¢ï¼šå®æ—¶ä¿¡æ¯æ£€ç´¢
\`\`\`

### æ ¸å¿ƒè®¾è®¡ç†å¿µ

| è®¾è®¡ç‰¹å¾ | è¯´æ˜ |
|---------|------|
| **é«˜åº¦æ¨¡å—åŒ–** | 5 ä¸ªç‹¬ç«‹å›¾ï¼Œå„å¸å…¶èŒï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±• |
| **æ™ºèƒ½è·¯ç”±** | generatePath é€šè¿‡æ¡ä»¶è§„åˆ™ç²¾å‡†å¯¼èˆªåˆ°ç›®æ ‡èŠ‚ç‚¹ |
| **ç‰ˆæœ¬ç®¡ç†** | å®Œæ•´çš„å·¥ä»¶å†å²ï¼Œæ”¯æŒç‰ˆæœ¬å›æ»š |
| **è®°å¿†ç³»ç»Ÿ** | æŒä¹…åŒ–ç”¨æˆ·é£æ ¼åå¥½å’Œäº‹å®ä¿¡æ¯ |
| **å¤š LLM æ”¯æŒ** | çµæ´»çš„æ¨¡å‹é€‰æ‹©å’Œæ™ºèƒ½é™çº§ç­–ç•¥ |
| **æ¶ˆæ¯åˆ†å±‚** | ç”¨æˆ·ç•Œé¢æ¶ˆæ¯ä¸æ¨¡å‹è¾“å…¥æ¶ˆæ¯åˆ†ç¦» |

---

## æ¶æ„å›¾

### æ•´ä½“ç³»ç»Ÿæ¶æ„

\`\`\`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Open Canvas ç³»ç»Ÿ                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚   Frontend   â”‚â”€â”€â”€â–¶â”‚  LangGraph   â”‚â”€â”€â”€â–¶â”‚   LLM APIs   â”‚       â”‚
â”‚  â”‚   (Next.js)  â”‚â—€â”€â”€â”€â”‚   Server     â”‚â—€â”€â”€â”€â”‚  (Multi-LLM) â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                             â”‚                                    â”‚
â”‚                             â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    LangGraph å›¾ç¼–æ’                       â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚  Main   â”‚ â”‚ Reflection â”‚ â”‚ Web Search â”‚ â”‚ Title   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  Agent  â”‚ â”‚   Graph    â”‚ â”‚   Graph    â”‚ â”‚ Graph   â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚    â”‚
â”‚  â”‚                    â”‚ Summarizer â”‚                        â”‚    â”‚
â”‚  â”‚                    â”‚   Graph    â”‚                        â”‚    â”‚
â”‚  â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                             â”‚                                    â”‚
â”‚                             â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    æŒä¹…åŒ–å­˜å‚¨                             â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚    â”‚
â”‚  â”‚  â”‚  Memories   â”‚  â”‚   Threads   â”‚  â”‚  Artifacts  â”‚      â”‚    â”‚
â”‚  â”‚  â”‚  (åæ€è®°å¿†)  â”‚  â”‚  (å¯¹è¯çº¿ç¨‹)  â”‚  â”‚  (ç‰ˆæœ¬å·¥ä»¶)  â”‚      â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
\`\`\`

### ä¸»æ™ºèƒ½ä½“æµç¨‹å›¾

\`\`\`
                              START
                                â”‚
                                â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  generatePath â”‚ â—€â”€â”€â”€ è·¯ç”±å†³ç­–å¼•æ“
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                   â”‚                   â”‚
            â–¼                   â–¼                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Artifact æ“ä½œ  â”‚   â”‚   ä¸»é¢˜ä¿®æ”¹     â”‚   â”‚   å…¶ä»–è·¯ç”±     â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚generateArtifactâ”‚   â”‚rewriteTheme   â”‚   â”‚replyToGeneral â”‚
    â”‚rewriteArtifact â”‚   â”‚rewriteCode    â”‚   â”‚customAction   â”‚
    â”‚updateArtifact  â”‚   â”‚Theme          â”‚   â”‚webSearch      â”‚
    â”‚updateHighlight â”‚   â”‚               â”‚   â”‚               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                   â”‚                   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚generateFollowupâ”‚ â—€â”€â”€â”€ ç”Ÿæˆè·Ÿè¿›æ¶ˆæ¯
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚    reflect    â”‚ â—€â”€â”€â”€ è§¦å‘è®°å¿†æ›´æ–°
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  cleanState   â”‚ â—€â”€â”€â”€ é‡ç½®çŠ¶æ€å‚æ•°
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚           â”‚           â”‚
                    â–¼           â–¼           â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚  END   â”‚ â”‚ genTitle â”‚ â”‚summarizerâ”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
\`\`\`

---

## ä¸»æ™ºèƒ½ä½“å›¾ (Open Canvas)

ä¸»æ™ºèƒ½ä½“æ˜¯ç³»ç»Ÿçš„æ ¸å¿ƒï¼Œè´Ÿè´£å¤„ç†æ‰€æœ‰ç”¨æˆ·äº¤äº’å’Œå·¥ä»¶æ“ä½œã€‚

### çŠ¶æ€å®šä¹‰ (State)

\`\`\`typescript
interface OpenCanvasGraphAnnotation {
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // æ¶ˆæ¯ç®¡ç†
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  messages: BaseMessage[];      // ç”¨æˆ·å¯è§çš„å®Œæ•´å¯¹è¯
  _messages: BaseMessage[];     // å†…éƒ¨æ¶ˆæ¯ï¼ˆå«æ‘˜è¦ï¼Œç”¨äºæ¨¡å‹è¾“å…¥ï¼‰

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // å·¥ä»¶ç®¡ç†
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  artifact: ArtifactV3;         // ç‰ˆæœ¬æ§åˆ¶å·¥ä»¶
  // â””â”€ currentIndex: number    // å½“å‰ç‰ˆæœ¬ç´¢å¼•
  // â””â”€ contents: Array<...>    // ç‰ˆæœ¬å†å²æ•°ç»„

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ç”¨æˆ·äº¤äº’çŠ¶æ€
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  highlightedCode: CodeHighlight;   // ä»£ç é«˜äº®é€‰åŒº
  highlightedText: TextHighlight;   // æ–‡æœ¬é«˜äº®é€‰åŒº

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // å¿«æ·æ“ä½œå‚æ•°
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  customQuickActionId: string;      // è‡ªå®šä¹‰æ“ä½œ ID
  language: LanguageOptions;        // ç¿»è¯‘è¯­è¨€
  artifactLength: ArtifactLengthOptions;  // è°ƒæ•´é•¿åº¦
  readingLevel: ReadingLevelOptions;      // é˜…è¯»çº§åˆ«
  regenerateWithEmojis: boolean;    // æ·»åŠ è¡¨æƒ…ç¬¦å·
  addComments: boolean;             // ä»£ç æ³¨é‡Š
  addLogs: boolean;                 // è°ƒè¯•æ—¥å¿—
  portLanguage: ProgrammingLanguageOptions;  // ä»£ç è½¬æ¢è¯­è¨€
  fixBugs: boolean;                 // ä¿®å¤æ¼æ´

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // æœç´¢ç›¸å…³
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  webSearchEnabled: boolean;        // æ˜¯å¦å¯ç”¨ç½‘ç»œæœç´¢
  webSearchResults: SearchResult[]; // æœç´¢ç»“æœ

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // è·¯ç”±æ§åˆ¶
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  next: string;                     // ä¸‹ä¸€ä¸ªèŠ‚ç‚¹åç§°
}
\`\`\`

### æ ¸å¿ƒèŠ‚ç‚¹è¯¦è§£

#### 1. generatePathï¼ˆè·¯ç”±å†³ç­–å¼•æ“ï¼‰

è¿™æ˜¯ç³»ç»Ÿçš„"æ™ºèƒ½äº¤é€šæ¢çº½"ï¼Œé€šè¿‡ä¼˜å…ˆçº§è§„åˆ™å†³å®šè¯·æ±‚æµå‘ï¼š

\`\`\`typescript
async function generatePath(state, config) {
  // â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  // â”‚ ä¼˜å…ˆçº§ 1: é«˜äº®é€‰åŒºæ“ä½œ                               â”‚
  // â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  if (state.highlightedCode) return "updateArtifact";
  if (state.highlightedText) return "updateHighlightedText";

  // â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  // â”‚ ä¼˜å…ˆçº§ 2: æ–‡æœ¬ä¸»é¢˜ä¿®æ”¹                               â”‚
  // â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  if (state.language || state.artifactLength ||
      state.regenerateWithEmojis || state.readingLevel) {
    return "rewriteArtifactTheme";
  }

  // â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  // â”‚ ä¼˜å…ˆçº§ 3: ä»£ç ä¸»é¢˜ä¿®æ”¹                               â”‚
  // â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  if (state.addComments || state.addLogs ||
      state.portLanguage || state.fixBugs) {
    return "rewriteCodeArtifactTheme";
  }

  // â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  // â”‚ ä¼˜å…ˆçº§ 4: ç‰¹æ®Šæ“ä½œ                                   â”‚
  // â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  if (state.customQuickActionId) return "customAction";
  if (state.webSearchEnabled) return "webSearch";

  // â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  // â”‚ ä¼˜å…ˆçº§ 5: åŠ¨æ€è·¯ç”±ï¼ˆLLM å†³ç­–ï¼‰                        â”‚
  // â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  return await dynamicDeterminePath({ state, config });
  // è¿”å›: "generateArtifact" | "rewriteArtifact" | "replyToGeneralInput"
}
\`\`\`

**è·¯ç”±å†³ç­–çŸ©é˜µ**ï¼š

| æ¡ä»¶ | ç›®æ ‡èŠ‚ç‚¹ | è¯´æ˜ |
|------|---------|------|
| \`highlightedCode\` å­˜åœ¨ | updateArtifact | æ›´æ–°é€‰ä¸­çš„ä»£ç  |
| \`highlightedText\` å­˜åœ¨ | updateHighlightedText | æ›´æ–°é€‰ä¸­çš„æ–‡æœ¬ |
| è¯­è¨€/é•¿åº¦/è¡¨æƒ…/é˜…è¯»çº§åˆ« | rewriteArtifactTheme | æ–‡æœ¬ä¸»é¢˜ä¿®æ”¹ |
| æ³¨é‡Š/æ—¥å¿—/è½¬æ¢/ä¿®å¤ | rewriteCodeArtifactTheme | ä»£ç ä¸»é¢˜ä¿®æ”¹ |
| \`customQuickActionId\` å­˜åœ¨ | customAction | æ‰§è¡Œè‡ªå®šä¹‰æ“ä½œ |
| \`webSearchEnabled\` ä¸º true | webSearch | ç½‘ç»œæœç´¢ |
| æ— å·¥ä»¶ + ç”Ÿæˆè¯·æ±‚ | generateArtifact | åˆ›å»ºæ–°å·¥ä»¶ |
| æœ‰å·¥ä»¶ + ä¿®æ”¹è¯·æ±‚ | rewriteArtifact | é‡å†™ç°æœ‰å·¥ä»¶ |
| ä¸€èˆ¬æ€§é—®é¢˜ | replyToGeneralInput | ç›´æ¥å›å¤ |

#### 2. generateArtifactï¼ˆå·¥ä»¶ç”Ÿæˆï¼‰

åˆ›å»ºæ–°çš„å·¥ä»¶ï¼ˆä»£ç æˆ–æ–‡æ¡£ï¼‰ï¼š

\`\`\`typescript
async function generateArtifact(state, config) {
  // 1. è·å–æ¨¡å‹é…ç½®
  const model = await getModelFromConfig(config, { isToolCalling: true });

  // 2. æ„å»ºæç¤ºè¯
  const systemPrompt = buildSystemPrompt({
    appContext: APP_CONTEXT,
    reflections: await getFormattedReflections(config),
    codeRules: DEFAULT_CODE_PROMPT_RULES
  });

  // 3. ç»‘å®šå·¥å…·å¹¶è°ƒç”¨
  const modelWithTool = model.bindTools([{
    name: "generate_artifact",
    schema: {
      title: z.string(),
      type: z.enum(["text", "code"]),
      language: z.string().optional(),
      content: z.string()
    }
  }]);

  // 4. åˆ›å»ºå·¥ä»¶ç‰ˆæœ¬ 1
  return {
    artifact: {
      currentIndex: 1,
      contents: [newArtifactContent]
    }
  };
}
\`\`\`

#### 3. rewriteArtifactï¼ˆå·¥ä»¶é‡å†™ï¼‰

å®Œæ•´é‡å†™ç°æœ‰å·¥ä»¶ï¼š

\`\`\`typescript
async function rewriteArtifact(state, config) {
  // 1. éªŒè¯å·¥ä»¶å­˜åœ¨
  if (!state.artifact) throw new Error("No artifact to rewrite");

  // 2. å¯é€‰ï¼šæ›´æ–°å…ƒæ•°æ®ï¼ˆæ ‡é¢˜/ç±»å‹ï¼‰
  const metadata = await getUpdatedMetadata(state, config);

  // 3. ä½¿ç”¨ UPDATE_ENTIRE_ARTIFACT_PROMPT é‡å†™
  const newContent = await model.invoke([
    systemPrompt,
    ...state._messages
  ]);

  // 4. æ·»åŠ æ–°ç‰ˆæœ¬ï¼ˆä¿ç•™å†å²ï¼‰
  return {
    artifact: {
      currentIndex: state.artifact.currentIndex + 1,
      contents: [...state.artifact.contents, newVersion]
    }
  };
}
\`\`\`

#### 4. updateArtifactï¼ˆéƒ¨åˆ†æ›´æ–°ï¼‰

æ›´æ–°é«˜äº®é€‰ä¸­çš„ä»£ç éƒ¨åˆ†ï¼š

\`\`\`typescript
async function updateArtifact(state, config) {
  // 1. æå–é«˜äº®åŒºåŸŸä¸Šä¸‹æ–‡ï¼ˆÂ±500 å­—ç¬¦ï¼‰
  const { before, highlighted, after } = extractContext(
    currentContent,
    state.highlightedCode
  );

  // 2. æ¨¡å‹åªç”Ÿæˆæ›¿æ¢å†…å®¹
  const replacement = await model.invoke(
    UPDATE_HIGHLIGHTED_ARTIFACT_PROMPT
  );

  // 3. æ‹¼æ¥å®Œæ•´å†…å®¹
  const newContent = before + replacement + after;

  // 4. åˆ›å»ºæ–°ç‰ˆæœ¬
  return { artifact: createNewVersion(state.artifact, newContent) };
}
\`\`\`

#### 5. generateFollowupï¼ˆè·Ÿè¿›ç”Ÿæˆï¼‰

ç”Ÿæˆç®€çŸ­çš„è·Ÿè¿›æ¶ˆæ¯ï¼š

\`\`\`typescript
async function generateFollowup(state, config) {
  const model = await getModelFromConfig(config, {
    isToolCalling: true,
    maxTokens: 250  // é™åˆ¶é•¿åº¦
  });

  const response = await model.invoke([
    FOLLOWUP_ARTIFACT_PROMPT,
    { artifact: getArtifactContent(state.artifact) },
    { reflections: await getFormattedReflections(config) }
  ]);

  // è¿”å›ç®€çŸ­ã€å‹å¥½çš„è·Ÿè¿›æ¶ˆæ¯
  // ä¾‹: "Does this capture what you had in mind?"
  return { messages: [new AIMessage(response)] };
}
\`\`\`

#### 6. cleanStateï¼ˆçŠ¶æ€æ¸…ç†ï¼‰

é‡ç½®æ‰€æœ‰å¿«æ·æ“ä½œå‚æ•°ï¼š

\`\`\`typescript
function cleanState(state) {
  return {
    language: undefined,
    artifactLength: undefined,
    readingLevel: undefined,
    addComments: undefined,
    addLogs: undefined,
    portLanguage: undefined,
    fixBugs: undefined,
    customQuickActionId: undefined,
    webSearchEnabled: false
  };
}
\`\`\`

### å¿«æ·æ“ä½œä¸€è§ˆ

#### æ–‡æœ¬æ“ä½œ (rewriteArtifactTheme)

| æ“ä½œ | æç¤ºè¯ | è¯´æ˜ |
|------|--------|------|
| ç¿»è¯‘ | CHANGE_ARTIFACT_LANGUAGE_PROMPT | ç¿»è¯‘åˆ°æŒ‡å®šè¯­è¨€ |
| é˜…è¯»çº§åˆ« | CHANGE_ARTIFACT_READING_LEVEL_PROMPT | è°ƒæ•´æ–‡æœ¬å¤æ‚åº¦ |
| æ·»åŠ è¡¨æƒ… | ADD_EMOJIS_TO_ARTIFACT_PROMPT | åœ¨æ–‡æœ¬ä¸­åŠ å…¥è¡¨æƒ…ç¬¦å· |
| è°ƒæ•´é•¿åº¦ | CHANGE_ARTIFACT_LENGTH_PROMPT | æ‰©å±•æˆ–ç¼©çŸ­æ–‡æœ¬ |

#### ä»£ç æ“ä½œ (rewriteCodeArtifactTheme)

| æ“ä½œ | æç¤ºè¯ | è¯´æ˜ |
|------|--------|------|
| æ·»åŠ æ³¨é‡Š | ADD_COMMENTS_TO_CODE_ARTIFACT_PROMPT | æ·»åŠ ä»£ç æ³¨é‡Š |
| æ·»åŠ æ—¥å¿— | ADD_LOGS_TO_CODE_ARTIFACT_PROMPT | æ·»åŠ è°ƒè¯•æ—¥å¿—è¯­å¥ |
| ä¿®å¤æ¼æ´ | FIX_BUGS_CODE_ARTIFACT_PROMPT | è¯†åˆ«å¹¶ä¿®å¤æ½œåœ¨ bug |
| è¯­è¨€è½¬æ¢ | PORT_LANGUAGE_CODE_ARTIFACT_PROMPT | è½¬æ¢åˆ°å…¶ä»–ç¼–ç¨‹è¯­è¨€ |

---

## åæ€å›¾ (Reflection)

åæ€å›¾è´Ÿè´£å­¦ä¹ ç”¨æˆ·çš„å†™ä½œé£æ ¼å’Œåå¥½ï¼Œæ„å»ºæŒä¹…åŒ–çš„ç”¨æˆ·è®°å¿†ã€‚

### æ¶æ„

\`\`\`
START â”€â”€â–¶ [reflect] â”€â”€â–¶ END
\`\`\`

### çŠ¶æ€å®šä¹‰

\`\`\`typescript
interface ReflectionGraphAnnotation {
  messages: BaseMessage[];      // å¯¹è¯å†å²
  artifact: ArtifactV3 | undefined;  // å½“å‰å·¥ä»¶
}
\`\`\`

### åæ€èŠ‚ç‚¹å®ç°

\`\`\`typescript
async function reflect(state, config) {
  const store = config.configurable.store;
  const memoryNamespace = ["memories", assistantId];

  // 1. æ£€ç´¢ç°æœ‰è®°å¿†
  const existingMemories = await store.get(memoryNamespace, "reflection");

  // 2. ä½¿ç”¨å›ºå®šæ¨¡å‹ç”Ÿæˆåæ€
  const model = new ChatAnthropic({
    model: "claude-3-5-sonnet-20240620",
    temperature: 0
  }).bindTools([{
    name: "generate_reflections",
    schema: {
      styleRules: z.array(z.string()),  // é£æ ¼è§„åˆ™åˆ—è¡¨
      content: z.array(z.string())      // ç”¨æˆ·äº‹å®åˆ—è¡¨
    }
  }]);

  // 3. è°ƒç”¨å¹¶å­˜å‚¨
  const result = await model.invoke([systemPrompt, userPrompt]);
  await store.put(memoryNamespace, "reflection", result.tool_calls[0].args);
}
\`\`\`

### è®°å¿†ç»“æ„

\`\`\`typescript
interface Reflections {
  styleRules: string[];  // å†™ä½œé£æ ¼åå¥½
  // ä¾‹: ["åå¥½ç®€æ´çš„å¥å­", "ä½¿ç”¨æŠ€æœ¯æœ¯è¯­", "é¿å…è¢«åŠ¨è¯­æ€"]

  content: string[];     // ç”¨æˆ·äº‹å®/åå¥½
  // ä¾‹: ["æ˜¯ä¸€åå‰ç«¯å¼€å‘è€…", "ä¸»è¦ä½¿ç”¨ React", "åå¥½ TypeScript"]
}
\`\`\`

### è®°å¿†ä½¿ç”¨æµç¨‹

\`\`\`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ generateArtifact â”‚ â—€â”€â”€â”€ æ³¨å…¥ reflections åˆ°æç¤ºè¯
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ generateFollowup â”‚ â—€â”€â”€â”€ ä½¿ç”¨ reflections ä¸ªæ€§åŒ–å›å¤
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     reflect     â”‚ â—€â”€â”€â”€ æ›´æ–° reflections
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LangGraph     â”‚
â”‚     Store       â”‚ â—€â”€â”€â”€ æŒä¹…åŒ–å­˜å‚¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
\`\`\`

---

## ç½‘ç»œæœç´¢å›¾ (Web Search)

ç½‘ç»œæœç´¢å›¾æä¾›å®æ—¶ä¿¡æ¯æ£€ç´¢èƒ½åŠ›ï¼ŒåŸºäº Exa API å®ç°ã€‚

### æ¶æ„

\`\`\`
        START
          â”‚
          â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚classifyMessageâ”‚ â—€â”€â”€â”€ åˆ¤æ–­æ˜¯å¦éœ€è¦æœç´¢
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
    â”‚           â”‚
    â–¼           â–¼
 éœ€è¦æœç´¢    ä¸éœ€è¦æœç´¢
    â”‚           â”‚
    â–¼           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚queryGen  â”‚    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
    â”‚           â”‚
    â–¼           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  search  â”‚    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
    â”‚           â”‚
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
         END
\`\`\`

### çŠ¶æ€å®šä¹‰

\`\`\`typescript
interface WebSearchGraphAnnotation {
  messages: BaseMessage[];
  query: string;                    // æœç´¢æŸ¥è¯¢
  webSearchResults: SearchResult[]; // æœç´¢ç»“æœ
  shouldSearch: boolean;            // æ˜¯å¦æ‰§è¡Œæœç´¢
}
\`\`\`

### èŠ‚ç‚¹å®ç°

#### classifyMessageï¼ˆæœç´¢åˆ†ç±»ï¼‰

\`\`\`typescript
async function classifyMessage(state) {
  const model = new ChatAnthropic({
    model: "claude-3-5-sonnet-latest",
    temperature: 0
  }).withStructuredOutput({
    schema: z.object({ shouldSearch: z.boolean() })
  });

  // è¯„ä¼°æ¶ˆæ¯æ˜¯å¦éœ€è¦ç½‘ç»œæœç´¢
  const response = await model.invoke([
    ["user", CLASSIFIER_PROMPT.replace("{message}", latestMessage)]
  ]);

  return { shouldSearch: response.shouldSearch };
}
\`\`\`

#### queryGeneratorï¼ˆæŸ¥è¯¢ç”Ÿæˆï¼‰

\`\`\`typescript
async function queryGenerator(state) {
  const model = new ChatAnthropic({
    model: "claude-3-5-sonnet-latest"
  });

  // å°†å¯¹è¯è½¬æ¢ä¸ºæœç´¢å‹å¥½çš„æŸ¥è¯¢
  const formattedPrompt = QUERY_GENERATOR_PROMPT
    .replace("{conversation}", formatMessages(state.messages))
    .replace("{additional_context}", \`Current date: \${today}\`);

  const response = await model.invoke([["user", formattedPrompt]]);
  return { query: response.content };
}
\`\`\`

### ä¸»å›¾ä¸­çš„æœç´¢é›†æˆ

\`\`\`typescript
// æœç´¢å®Œæˆåçš„è·¯ç”±
function routePostWebSearch(state) {
  if (!state.webSearchResults?.length) {
    return hasArtifact ? "rewriteArtifact" : "generateArtifact";
  }

  // åˆ›å»ºæœç´¢ç»“æœæ¶ˆæ¯å¹¶æ³¨å…¥åˆ°çŠ¶æ€
  const searchResultsMessage = createAIMessageFromWebResults(
    state.webSearchResults
  );

  return new Command({
    goto: hasArtifact ? "rewriteArtifact" : "generateArtifact",
    update: {
      webSearchEnabled: false,
      messages: [searchResultsMessage],
      _messages: [searchResultsMessage]
    }
  });
}
\`\`\`

---

## æ ‡é¢˜ç”Ÿæˆå›¾ (Thread Title)

è‡ªåŠ¨ä¸ºå¯¹è¯çº¿ç¨‹ç”Ÿæˆæœ‰æ„ä¹‰çš„æ ‡é¢˜ã€‚

### æ¶æ„

\`\`\`
START â”€â”€â–¶ [generateTitle] â”€â”€â–¶ END
\`\`\`

### å®ç°

\`\`\`typescript
async function generateTitle(state, config) {
  const threadId = config.configurable.open_canvas_thread_id;

  // ä½¿ç”¨è½»é‡çº§æ¨¡å‹ç”Ÿæˆæ ‡é¢˜
  const model = new ChatOpenAI({
    model: "gpt-4o-mini",
    temperature: 0
  }).bindTools([{
    name: "generate_title",
    schema: { title: z.string() }
  }]);

  const result = await model.invoke([
    { role: "system", content: TITLE_SYSTEM_PROMPT },
    { role: "user", content: TITLE_USER_PROMPT
        .replace("{conversation}", formatMessages(state.messages))
        .replace("{artifact_context}", artifactContent)
    }
  ]);

  // æ›´æ–°çº¿ç¨‹å…ƒæ•°æ®
  const langGraphClient = new Client();
  await langGraphClient.threads.update(threadId, {
    metadata: { thread_title: result.tool_calls[0].args.title }
  });
}
\`\`\`

### è§¦å‘æ¡ä»¶

\`\`\`typescript
// ä»…åœ¨é¦–æ¬¡äº¤äº’æ—¶è§¦å‘
if (state.messages.length <= 2) {
  return "generateTitle";
}
\`\`\`

---

## æ‘˜è¦å›¾ (Summarizer)

å½“å¯¹è¯è¿‡é•¿æ—¶è‡ªåŠ¨å‹ç¼©å†å²æ¶ˆæ¯ã€‚

### æ¶æ„

\`\`\`
START â”€â”€â–¶ [summarize] â”€â”€â–¶ END
\`\`\`

### è§¦å‘æ¡ä»¶

\`\`\`typescript
const CHARACTER_MAX = 300_000;  // ~75K tokens

function shouldSummarize(state) {
  const totalChars = state.messages
    .map(m => getStringFromContent(m.content))
    .join('')
    .length;

  return totalChars > CHARACTER_MAX;
}
\`\`\`

### å®ç°

\`\`\`typescript
async function summarizer(state) {
  const model = new ChatAnthropic({
    model: "claude-3-5-sonnet-latest"
  });

  // ç”Ÿæˆæ‘˜è¦
  const response = await model.invoke([
    ["system", SUMMARIZER_PROMPT],
    ["user", \`Messages to summarize:\\n\${formatMessages(state.messages)}\`]
  ]);

  // åˆ›å»ºå¸¦ç‰¹æ®Šæ ‡è®°çš„æ‘˜è¦æ¶ˆæ¯
  const summaryMessage = new HumanMessage({
    id: uuidv4(),
    content: \`Summary of past messages:\\n\${response.content}\`,
    additional_kwargs: {
      [OC_SUMMARIZED_MESSAGE_KEY]: true  // ç‰¹æ®Šæ ‡è®°
    }
  });

  // çŠ¶æ€ç¼©å‡å™¨è¯†åˆ«æ­¤æ ‡è®°ï¼Œæ¸…ç©ºæ—§æ¶ˆæ¯
  await client.threads.updateState(threadId, {
    values: { _messages: [summaryMessage] }
  });
}
\`\`\`

### æ¶ˆæ¯ç¼©å‡æœºåˆ¶

\`\`\`typescript
// çŠ¶æ€æ³¨è§£ä¸­çš„æ¶ˆæ¯ç¼©å‡å™¨
_messages: Annotation<BaseMessage[]>({
  reducer: (existing, update) => {
    // æ£€æµ‹æ‘˜è¦æ¶ˆæ¯
    if (update.some(m => m.additional_kwargs[OC_SUMMARIZED_MESSAGE_KEY])) {
      return update;  // æ¸…ç©ºæ—§æ¶ˆæ¯ï¼Œåªä¿ç•™æ‘˜è¦
    }
    return [...existing, ...update];
  }
})
\`\`\`

---

## å·¥å…·å‡½æ•°åº“

### åæ€ç®¡ç†

\`\`\`typescript
// æ ¼å¼åŒ–åæ€ä¸ºæç¤ºè¯
formatReflections(reflections, { onlyStyle?, onlyContent? })
  â†’ å°† styleRules å’Œ content æ ¼å¼åŒ–ä¸º XML æ ‡ç­¾

// ä»å­˜å‚¨æ£€ç´¢åæ€
getFormattedReflections(config)
  â†’ è¿”å›æ ¼å¼åŒ–åçš„ç”¨æˆ·åæ€å­—ç¬¦ä¸²

// éªŒè¯å­˜å‚¨é…ç½®
ensureStoreInConfig(config)
  â†’ ç¡®ä¿ LangGraph Store å¯ç”¨
\`\`\`

### æ¶ˆæ¯ç®¡ç†

\`\`\`typescript
// æ ¼å¼åŒ–æ¶ˆæ¯ä¸ºå¯è¯»æ–‡æœ¬
formatMessages(messages)
  â†’ "Human: ...\\nAssistant: ..."

// æœç´¢ç»“æœè½¬ AI æ¶ˆæ¯
createAIMessageFromWebResults(results)
  â†’ AIMessage with formatted search results

// æå–æ¶ˆæ¯æ–‡æœ¬å†…å®¹
getStringFromContent(content)
  â†’ ä»å¤æ‚æ¶ˆæ¯ç»“æ„ä¸­æå–çº¯æ–‡æœ¬
\`\`\`

### æ¨¡å‹ç®¡ç†

\`\`\`typescript
// è·å–æ¨¡å‹é…ç½®
getModelConfig(config, options)
  â†’ { modelName, modelProvider }

// åˆå§‹åŒ–æ¨¡å‹å®ä¾‹
getModelFromConfig(config, { isToolCalling, maxTokens })
  â†’ ChatOpenAI | ChatAnthropic | ChatGoogleGenerativeAI | ...

// æ£€æµ‹ç‰¹æ®Šæ¨¡å‹
isUsingO1MiniModel(config)  // o1 ç³»åˆ—éœ€ç‰¹æ®Šå¤„ç†
isThinkingModel(modelName)  // æ€ç»´æ¨¡å‹éœ€æå– thinking

// æå–æ€ç»´å†…å®¹
extractThinkingAndResponseTokens(content)
  â†’ { thinking: string, response: string }
\`\`\`

### å·¥ä»¶æ“ä½œ

\`\`\`typescript
// è·å–å½“å‰ç‰ˆæœ¬å†…å®¹
getArtifactContent(artifact)
  â†’ artifact.contents[artifact.currentIndex - 1]

// ç±»å‹åˆ¤æ–­
isArtifactMarkdownContent(content)  â†’ boolean
isArtifactCodeContent(content)      â†’ boolean
\`\`\`

---

## æç¤ºè¯ç­–ç•¥

### æ ¸å¿ƒæç¤ºè¯åŸåˆ™

| åŸåˆ™ | è¯´æ˜ |
|------|------|
| **åº”ç”¨ä¸Šä¸‹æ–‡** | è§£é‡Š Open Canvas æ˜¯ä»€ä¹ˆï¼Œè¯´æ˜å•å·¥ä»¶è®¾è®¡ |
| **ä»£ç è§„åˆ™** | React æ ·å¼æ”¾ style å…ƒç´ ï¼Œä¸åŒ…å«ä¸‰åå¼•å· |
| **ä¿®æ”¹çº¦æŸ** | ä»…ä¿®æ”¹è¯·æ±‚çš„æ–¹é¢ï¼Œä¸æ”¹å˜åŸå§‹å«ä¹‰ |
| **è¾“å‡ºæ ¼å¼** | è¿”å›å®Œæ•´å†…å®¹ï¼Œä¸æ·»åŠ  XML æ ‡ç­¾ |

### æç¤ºè¯æ¸…å•

| æç¤ºè¯ | ç”¨é€” | ä½¿ç”¨æ¨¡å‹ |
|--------|------|---------|
| \`NEW_ARTIFACT_PROMPT\` | ç”Ÿæˆæ–°å·¥ä»¶ | é…ç½®æ¨¡å‹ |
| \`UPDATE_ENTIRE_ARTIFACT_PROMPT\` | å®Œæ•´é‡å†™ | é…ç½®æ¨¡å‹ |
| \`UPDATE_HIGHLIGHTED_ARTIFACT_PROMPT\` | éƒ¨åˆ†ç¼–è¾‘ | é…ç½®æ¨¡å‹ |
| \`CHANGE_ARTIFACT_LANGUAGE_PROMPT\` | ç¿»è¯‘ | é…ç½®æ¨¡å‹ |
| \`CHANGE_ARTIFACT_READING_LEVEL_PROMPT\` | é˜…è¯»çº§åˆ« | é…ç½®æ¨¡å‹ |
| \`ADD_EMOJIS_TO_ARTIFACT_PROMPT\` | æ·»åŠ è¡¨æƒ… | é…ç½®æ¨¡å‹ |
| \`ADD_COMMENTS_TO_CODE_ARTIFACT_PROMPT\` | ä»£ç æ³¨é‡Š | é…ç½®æ¨¡å‹ |
| \`ADD_LOGS_TO_CODE_ARTIFACT_PROMPT\` | è°ƒè¯•æ—¥å¿— | é…ç½®æ¨¡å‹ |
| \`FIX_BUGS_CODE_ARTIFACT_PROMPT\` | ä¿®å¤æ¼æ´ | é…ç½®æ¨¡å‹ |
| \`PORT_LANGUAGE_CODE_ARTIFACT_PROMPT\` | ä»£ç è½¬æ¢ | é…ç½®æ¨¡å‹ |
| \`FOLLOWUP_ARTIFACT_PROMPT\` | è·Ÿè¿›æ¶ˆæ¯ | å°æ¨¡å‹ |
| \`ROUTE_QUERY_PROMPT\` | è·¯ç”±å†³ç­– | é…ç½®æ¨¡å‹ |
| \`REFLECT_SYSTEM_PROMPT\` | è®°å¿†ç”Ÿæˆ | Claude 3.5 |
| \`CLASSIFIER_PROMPT\` | æœç´¢åˆ†ç±» | Claude 3.5 |
| \`QUERY_GENERATOR_PROMPT\` | æŸ¥è¯¢ä¼˜åŒ– | Claude 3.5 |
| \`TITLE_USER_PROMPT\` | æ ‡é¢˜ç”Ÿæˆ | GPT-4o-mini |
| \`SUMMARIZER_PROMPT\` | å¯¹è¯æ‘˜è¦ | Claude 3.5 |

---

## å¤šæ¨¡å‹æ”¯æŒ

### æ¨¡å‹é€‰æ‹©ç­–ç•¥

| èŠ‚ç‚¹ | æ¨¡å‹é€‰æ‹© | è¯´æ˜ |
|------|---------|------|
| generatePath | é…ç½®æ¨¡å‹ | ç”¨æˆ·é€‰æ‹©çš„ä¸»æ¨¡å‹ |
| generateArtifact | é…ç½®æ¨¡å‹ | æ”¯æŒå·¥å…·è°ƒç”¨ |
| rewriteArtifact | é…ç½®æ¨¡å‹ | æ”¯æŒå·¥å…·è°ƒç”¨ |
| updateArtifact | é…ç½®æ¨¡å‹/é™çº§ | ç®€å•æ¨¡å‹é™çº§åˆ° GPT-4o |
| generateFollowup | é…ç½®æ¨¡å‹ï¼ˆå°ï¼‰ | maxTokens: 250 |
| reflect | Claude 3.5 Sonnet | å›ºå®šï¼Œç¡®ä¿è´¨é‡ |
| generateTitle | GPT-4o-mini | å›ºå®šï¼Œè½»é‡çº§ |
| classifyMessage | Claude 3.5 Sonnet | å›ºå®š |
| queryGenerator | Claude 3.5 Sonnet | å›ºå®š |
| summarizer | Claude 3.5 Sonnet | å›ºå®š |

### ç‰¹æ®Šæ¨¡å‹å¤„ç†

#### O1 ç³»åˆ—æ¨¡å‹

\`\`\`typescript
if (isUsingO1MiniModel(modelName)) {
  // o1 ç³»åˆ—ä¸æ”¯æŒ system è§’è‰²
  // å°†ç³»ç»Ÿæç¤ºä½œä¸ºç”¨æˆ·æ¶ˆæ¯å‘é€
  messages = [
    { role: "user", content: systemPrompt },
    ...userMessages
  ];
}
\`\`\`

#### æ€ç»´æ¨¡å‹ (Claude Extended Thinking)

\`\`\`typescript
if (isThinkingModel(modelName)) {
  const { thinking, response } = extractThinkingAndResponseTokens(content);

  // thinking ä¿å­˜ä¸ºå•ç‹¬çš„ AI æ¶ˆæ¯
  // ä¾›ç”¨æˆ·åœ¨ UI ä¸­æŸ¥çœ‹æ€è€ƒè¿‡ç¨‹
  return {
    messages: [
      new AIMessage({ content: thinking, name: "thinking" }),
      new AIMessage({ content: response })
    ]
  };
}
\`\`\`

### æ”¯æŒçš„ LLM æä¾›å•†

| æä¾›å•† | åŒ… | å…¸å‹æ¨¡å‹ |
|--------|-----|---------|
| OpenAI | \`@langchain/openai\` | GPT-4o, GPT-4o-mini, o1 |
| Anthropic | \`@langchain/anthropic\` | Claude 3.5 Sonnet, Claude 3 Opus |
| Google | \`@langchain/google-genai\` | Gemini Pro, Gemini Ultra |
| Groq | \`@langchain/groq\` | Llama, Mixtral |
| Fireworks | \`@langchain/community\` | å„ç§å¼€æºæ¨¡å‹ |
| Ollama | \`@langchain/ollama\` | æœ¬åœ°æ¨¡å‹ |

---

## æ•°æ®æµæ€»ç»“

### å®Œæ•´è¯·æ±‚æµç¨‹

\`\`\`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·è¯·æ±‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. generatePath è·¯ç”±å†³ç­–                                         â”‚
â”‚    - æ£€æŸ¥å¿«æ·æ“ä½œå‚æ•°                                             â”‚
â”‚    - æ£€æŸ¥é«˜äº®é€‰åŒº                                                 â”‚
â”‚    - åŠ¨æ€ LLM åˆ†ç±»                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. æ ¸å¿ƒå¤„ç†èŠ‚ç‚¹                                                   â”‚
â”‚    - generateArtifact / rewriteArtifact / updateArtifact        â”‚
â”‚    - rewriteTheme / customAction / webSearch                    â”‚
â”‚    - replyToGeneralInput                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. åå¤„ç†                                                        â”‚
â”‚    - generateFollowupï¼ˆç”Ÿæˆè·Ÿè¿›æ¶ˆæ¯ï¼‰                             â”‚
â”‚    - reflectï¼ˆæ›´æ–°ç”¨æˆ·è®°å¿†ï¼‰                                      â”‚
â”‚    - cleanStateï¼ˆé‡ç½®çŠ¶æ€ï¼‰                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. æ¡ä»¶åå¤„ç†                                                     â”‚
â”‚    - generateTitleï¼ˆé¦–æ¬¡å¯¹è¯ï¼‰                                    â”‚
â”‚    - summarizerï¼ˆè¶…é•¿å¯¹è¯ï¼‰                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å“åº”è¿”å›                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
\`\`\`

### ç‰ˆæœ¬æ§åˆ¶æœºåˆ¶

\`\`\`
ArtifactV3 {
  currentIndex: 3,           // å½“å‰æ˜¾ç¤ºç‰ˆæœ¬ 3
  contents: [
    { v1 content... },       // ç‰ˆæœ¬ 1ï¼ˆåˆå§‹ï¼‰
    { v2 content... },       // ç‰ˆæœ¬ 2ï¼ˆç¬¬ä¸€æ¬¡ä¿®æ”¹ï¼‰
    { v3 content... },       // ç‰ˆæœ¬ 3ï¼ˆå½“å‰ï¼‰â† currentIndex æŒ‡å‘è¿™é‡Œ
  ]
}

ç”¨æˆ·å¯ä»¥ï¼š
- æµè§ˆå†å²ç‰ˆæœ¬
- å›æ»šåˆ°ä»»æ„ç‰ˆæœ¬
- ä»å†å²ç‰ˆæœ¬åˆ†æ”¯
\`\`\`

---

## æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°çš„å¿«æ·æ“ä½œ

1. åœ¨ \`state.ts\` ä¸­æ·»åŠ æ–°çš„çŠ¶æ€å­—æ®µ
2. åœ¨ \`generatePath\` ä¸­æ·»åŠ è·¯ç”±æ¡ä»¶
3. åˆ›å»ºæ–°çš„å¤„ç†èŠ‚ç‚¹æˆ–å¤ç”¨ç°æœ‰èŠ‚ç‚¹
4. åœ¨ \`prompts.ts\` ä¸­æ·»åŠ å¯¹åº”æç¤ºè¯
5. åœ¨ \`cleanState\` ä¸­æ·»åŠ çŠ¶æ€é‡ç½®

### æ·»åŠ æ–°çš„å›¾

1. åœ¨ \`apps/agents/src/\` ä¸‹åˆ›å»ºæ–°ç›®å½•
2. å®ç° \`index.ts\`ï¼ˆå›¾å®šä¹‰ï¼‰ã€\`state.ts\`ï¼ˆçŠ¶æ€ï¼‰ã€\`nodes.ts\`ï¼ˆèŠ‚ç‚¹ï¼‰
3. åœ¨ \`langgraph.json\` ä¸­æ³¨å†Œæ–°å›¾
4. åœ¨ä¸»å›¾ä¸­æ·»åŠ è°ƒç”¨é€»è¾‘ï¼ˆå¦‚éœ€è¦ï¼‰

### æ”¯æŒæ–°çš„ LLM æä¾›å•†

1. å®‰è£…å¯¹åº”çš„ \`@langchain/*\` åŒ…
2. åœ¨ \`packages/shared/src/models.ts\` ä¸­æ·»åŠ æ¨¡å‹é…ç½®
3. åœ¨ \`apps/agents/src/utils.ts\` çš„ \`getModelFromConfig\` ä¸­æ·»åŠ åˆå§‹åŒ–é€»è¾‘
4. æµ‹è¯•ï¼šç”Ÿæˆå·¥ä»¶ã€è·Ÿè¿›æ¶ˆæ¯ã€å¿«æ·æ“ä½œ

---

## å‚è€ƒèµ„æº

- [LangGraph å®˜æ–¹æ–‡æ¡£](https://langchain-ai.github.io/langgraph/)
- [Open Canvas GitHub](https://github.com/langchain-ai/open-canvas)
- [LangChain TypeScript](https://js.langchain.com/)
`;

    // Configure marked
    marked.setOptions({
      highlight: function(code, lang) {
        if (lang && hljs.getLanguage(lang)) {
          return hljs.highlight(code, { language: lang }).value;
        }
        return hljs.highlightAuto(code).value;
      },
      breaks: false,
      gfm: true
    });

    // Render markdown
    function renderContent() {
      const contentEl = document.getElementById('content');
      contentEl.innerHTML = marked.parse(markdownContent);

      // Add anchor links to headings
      contentEl.querySelectorAll('h2[id], h3[id], h4[id]').forEach(heading => {
        const anchor = document.createElement('a');
        anchor.className = 'anchor-link';
        anchor.href = '#' + heading.id;
        anchor.textContent = '#';
        heading.insertBefore(anchor, heading.firstChild);
      });

      // Generate TOC
      generateTOC();

      // Apply syntax highlighting to code blocks
      document.querySelectorAll('pre code').forEach((block) => {
        hljs.highlightElement(block);
      });
    }

    // Generate Table of Contents
    function generateTOC() {
      const tocEl = document.getElementById('toc');
      const headings = document.querySelectorAll('.content h2, .content h3, .content h4');

      headings.forEach((heading, index) => {
        // Generate ID if not exists
        if (!heading.id) {
          heading.id = 'heading-' + index;
        }

        const li = document.createElement('li');
        li.className = 'toc-item';

        const a = document.createElement('a');
        a.className = 'toc-link level-' + heading.tagName.charAt(1);
        a.href = '#' + heading.id;
        a.textContent = heading.textContent.replace(/^#\s*/, '');

        li.appendChild(a);
        tocEl.appendChild(li);
      });
    }

    // Highlight active TOC item on scroll
    function highlightActiveTOC() {
      const headings = document.querySelectorAll('.content h2, .content h3, .content h4');
      const tocLinks = document.querySelectorAll('.toc-link');

      let activeIndex = 0;
      const scrollPos = window.scrollY + 100;

      headings.forEach((heading, index) => {
        if (heading.offsetTop <= scrollPos) {
          activeIndex = index;
        }
      });

      tocLinks.forEach((link, index) => {
        link.classList.toggle('active', index === activeIndex);
      });
    }

    // Theme toggle
    function toggleTheme() {
      const body = document.body;
      const isDark = body.getAttribute('data-theme') !== 'light';

      if (isDark) {
        body.setAttribute('data-theme', 'light');
        document.getElementById('theme-icon').textContent = 'â˜€ï¸';
        document.getElementById('theme-text').textContent = 'æµ…è‰²';
        // Switch to light highlight.js theme
        document.querySelector('link[href*="highlight"]').href =
          'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css';
      } else {
        body.removeAttribute('data-theme');
        document.getElementById('theme-icon').textContent = 'ğŸŒ™';
        document.getElementById('theme-text').textContent = 'æ·±è‰²';
        // Switch to dark highlight.js theme
        document.querySelector('link[href*="highlight"]').href =
          'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css';
      }

      localStorage.setItem('theme', isDark ? 'light' : 'dark');
    }

    // Load saved theme
    function loadTheme() {
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'light') {
        document.body.setAttribute('data-theme', 'light');
        document.getElementById('theme-icon').textContent = 'â˜€ï¸';
        document.getElementById('theme-text').textContent = 'æµ…è‰²';
        document.querySelector('link[href*="highlight"]').href =
          'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css';
      }
    }

    // Sidebar toggle (mobile)
    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('open');
    }

    // Back to top
    function scrollToTop() {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // Show/hide back to top button
    function toggleBackToTop() {
      const btn = document.getElementById('back-to-top');
      btn.classList.toggle('visible', window.scrollY > 300);
    }

    // Close sidebar when clicking a link (mobile)
    document.getElementById('toc').addEventListener('click', (e) => {
      if (e.target.classList.contains('toc-link')) {
        document.getElementById('sidebar').classList.remove('open');
      }
    });

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      loadTheme();
      renderContent();

      // Scroll events
      let ticking = false;
      window.addEventListener('scroll', () => {
        if (!ticking) {
          window.requestAnimationFrame(() => {
            highlightActiveTOC();
            toggleBackToTop();
            ticking = false;
          });
          ticking = true;
        }
      });
    });
  </script>
</body>
</html>
